{% extends "free/base.html" %}
{% load i18n%}
{% load static %}

{% load quiz_tags %}


{% block headscript%}
	<script id="csrf_token" type="application/json">{{csrf_token}}</script>

	<script>
		X_CSRFToken = document.getElementById('csrf_token').textContent
	</script>

{% endblock %}

{% block head %}

    <!-- datatables -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.semanticui.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.semanticui.min.css">


    <!-- datatables  buutons (copy , csv excel)-->
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.semanticui.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.semanticui.min.css">



    {% block experiment_head %}
    {% endblock %} 


{% endblock %}  




{% block title %} {{ quiz.title }} {% endblock %}
{% block description %} {{ quiz.title }} - {{ quiz.description }} {% endblock %}


{% block content %}

<div class="right floated thirteen wide computer sixteen wide phone column"  id="content">

	<div class="ui container">

		<h1>Quiz: {{quiz.title}}</h1>

	</div> 
	<div class="ui  container ">
		<div id="quiz_tab" class="ui top attached tabular menu">
			<a class=" item" id="description-tab-slip" data-tab="description-tab">{% trans 'Description' %}</a>
			<a class="item active" id="result-tab-slip" data-tab="result-tab">{% trans 'Results'%}</a>
		</div>

	
		<div class="ui bottom attached tab segment" data-tab="description-tab" >
			<div class="ui grid" >
				<div class="ten wide column ">
          {% autoescape off %}{{quiz.description}}{% endautoescape %}
				</div>
	
			</div>  
		</div>


		<div class="ui bottom attached tab segment active" data-tab="result-tab" >
			<div class="ui grid" >
				<div class="ten sixteen column ">



{% if lti == True %}
          <div class="ui container segment">
            <h2>
              Grade submission
            </h2>
  {% if lti_submited == 'OK'%}
      <br>
      <div class="ui green message">
        <p>Grade sucessfully suibmited to the course platform<p>
        <p>Press the foillowing button to continue youir course</p>
      </div>

      <a href=" {{redirect_url}}">               
        <button class="ui green right labeled icon button">
          continue to course
        </button>
      </a>
  {% else %}
    {% if lti_submited == 'ERROR'%}
      <div class="ui red message">
            <p>there was an error sumbitting your grade.</p>
            <p>try resubmitting with the nexty button, or, if the problem remains, go the the Course web site, and restart your quizz from there. </p>
      </div>
    {% endif %}
      <p>In order to submit the grade of this quiz, press the following button.</p>

      <form class="ui form" action="{% url 'FREE_quizes:quiz_submit_lti'  quiz_name=quiz.title%}" method="POST" id="form">{% csrf_token %}
        <button id="submitQuizGradeButton" class="ui green right labeled icon button">
          Submit grades to course
        </button>
        <input type=hidden name="submit_lti_grade" value="true">
        </form>	
    {% endif %}
  </div>
{% else %}
  {% if not sitting.archived %}
              <div class="ui container segment">
                <a href="{% url 'FREE_quizes:quiz_index'%}"><button class='ui button'>{% trans 'Return to Quiz list'%}</button></a> 
                <h2> In order to repeat the quiz you need to archive this one first.
                <form class="ui form" action="" method="POST" id="form">{% csrf_token %}
                  <button id="archiveQuizButton" class="ui green right labeled icon button">
                    Archive Quiz
                  </button>
                  <input type=hidden name="archive_quiz" value="true">
                </form>	

                
            </div>
  {% endif %}
{% endif %}
  
  

  

{% if max_score %}
        
          <div>

            <h2>
              Quizz outcome
            </h2>
            <p>
              This quis comprised {{final_result.total_steps}} steps,  {{final_result.evaluated_questions}} of these steps were questions to be evaluated and graded.
              {% trans "You answered" %} {{final_result.correct_questions}} correct questions.
            </p>
            <h2>
              Exercises score
            </h2>
            <p>
              The score of this exercise (taking into consideration the weight of each question) is {{ final_result.grade_percent }} {% trans "percent correct" %}.
            </p>
            {% if quiz.pass_mark %}
            <p class="lead">{% autoescape off %}{{ sitting.result_message }}{% endautoescape %}</p>
            {% endif %}
          
          
         
            {% if user.is_authenticateds %}
                <p>{% trans "The result of this exam will be stored in your progress section so you can review and monitor your progression" %}.</p>
            {% endif %}
          </div>
{% endif %}
      
        
{% if questions %}
          <h2>
            Answers overview
          </h2>
          <p>{% trans "Review the questions below and try the exam again in the future"%}.</p>
          <div class="ui sixteen container">
            <table class="ui celled table">
              <thead>
                <tr>
                  <th>Question</th>
                  <th>Answer</th>
                  <th>Evaluated</th>
                  <th>Question weight</th>
                  <th>Question Grade</th>
                  <th>Explanation</th>
                </tr>
              </thead>
              <tbody>
                {% for question in details %}
                <tr>
                  <td>
                    {% autoescape off %}{{ question.question.content }}{% endautoescape %}
                  </td>
                  <td>
                    {% autoescape off %} {{ question.answer.answer | pretty_json  }}{% endautoescape %}
                  </td>
                  <td>
                    {{ question.answer.evaluated }}
                  </td>
                  {% if question.answer.evaluated %}
                    <td>
                      {{ question.answer.evaluationWeight }}
                    </td>
                    <td>
                      {% if question.answer.grade > 0.5 %}
                        <div class="well " style="background-color: #99edc3;">
                      {% else %}
                        <div class="well " style="background-color: #bc544b;">
                      {% endif %}

                        {{ question.answer.grade |stringformat:".2f"}}
                        </div>
                    </td>
                    <td>
                      {% autoescape off %} {{ question.answer.explanation }}{% endautoescape %}
                    </td>
                    {% else %}
                    <td>  </td><td>  </td><td>  </td>

                    {% endif %}
                </tr>
              {% endfor %}
              </tbody>
              <tfoot>
                <tr>
                  <th colspan="3">
                  Quiz
                  </th>
                  <th>
                    {{final_result.evaluated_weight}}
                  </th>
                  <th>  
                    {{final_result.correct_weight}}
                  </th>
                  <th>   
                    {{final_result.grade_percent|stringformat:"d%%"}}
                  </th>
                </tr>
              </tfoot>
            </table>
          </div>
{% endif %}
        


        </div>
			</div>
		</div>  
	</div>
</div>


{% endblock %}

{% block script %}
<script type='text/javascript'>
  document.addEventListener("DOMContentLoaded", () => {
    $('.tabular.menu .item').tab();                  
  });
</script>

{% endblock%}











