{% extends base %}
{% load i18n %}
{% load static %}

{% load quiz_tags %}

{% block headscript%}
	<script id="csrf_token" type="application/json">{{csrf_token}}</script>
	{{apparatus.config|json_script:"apparatus-config"}}
	{{apparatus.id|json_script:"apparatus-id"}}
	{{protocol.config|json_script:"protocol-config"}}
	{{protocol.id|json_script:"protocol-id"}}
	{{execution_json|json_script:"execution-config"}}
	{{final_result|json_script:"final-result"}}
	{{quiz.id|json_script:"quiz-id"}}

	<script>
		X_CSRFToken = document.getElementById('csrf_token').textContent

		var apparatus_id = JSON.parse(document.getElementById('apparatus-id').textContent);
		var protocol_id = JSON.parse(document.getElementById('protocol-id').textContent);
		var current_execution = JSON.parse(document.getElementById('execution-config').textContent);
		var quiz_id = JSON.parse(document.getElementById('quiz-id').textContent);

	</script>

{% endblock %}

{% block head %}

    <!-- datatables -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.semanticui.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.semanticui.min.css">


    <!-- datatables  buutons (copy , csv excel)-->
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.semanticui.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.semanticui.min.css">


    <!-- Video -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/8.0.0/adapter.min.js" ></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>


    {% block experiment_head %}
    {% endblock %} 


{% endblock %}  



{% block title %} {{ quiz.title }} {% endblock %}
{% block description %} {{ quiz.title }} - {{ quiz.description }} {% endblock %}


{% block content %}

<div class="right floated thirteen wide computer sixteen wide phone column"  id="content">

	<div class="ui container">

    <h1>You've finished the quiz {{quiz.title}}</h1>
		{% if progress %}
		<H2>
		{% trans "Question" %} {{ progress.0|add:1 }} {% trans "of" %} {{ progress.1 }}
		</h2>
		{% endif %}

	</div> 
	<div class="ui  container ">
		<div id="quiz_tab" class="ui top attached tabular menu">
			<a class=" item" id="description-tab-slip" data-tab="description-tab">{% trans 'Description' %}</a>
			<a class="item active" id="result-tab-slip" data-tab="result-tab">{% trans 'Results'%}</a>
		</div>

	
		<div class="ui bottom attached tab segment" data-tab="description-tab" >
			<div class="ui grid" >
				<div class="ten wide column ">
          {% autoescape off %}{{quiz.description}}{% endautoescape %}
				</div>
	
			</div>  
		</div>


		<div class="ui bottom attached tab segment active" data-tab="result-tab" >
			<div class="ui grid" >
				<div class="ten wide column ">


          {% if lti == True %}
          <div class="ui raised very padded text container segment">
            <h2>
              Grade submission
            </h2>
                      In order to submit the grade of this exercise, press the following button.
                      <br>
              <form action="{% url 'lti_provider:lti-post-grade'%}"  method="post">{% csrf_token %}
                <label for="Submit Grade "></label>
                <input type=hidden name="score" value="{{score_send|stringformat:".2f"}}">
                <input type=hidden name="sitting_pk" value="{{sitting.pk}}">
                <input type=hidden name="app_name" value="{{app_name}}">
                <button class="ui button" type="submit">Submit grade</button>
              </form>
              <br>
              Dont forget to reload your original course page to update your grade!
              </div>
  {% else %}
  <a href="{% url 'FREE_quizes:quiz_index'%}"><button class='ui button'>{% trans 'Return to Quiz list'%}</button></a> 
  {% endif %}
  
  
  


           {% if max_score %}
        
          <div>

            <h2>
              Quizz outcome
            </h2>
            <p>
              {% trans "You answered" %} {{correct_answers}} {% trans "questions correctly out of" %} {{ max_score }}.
            </p>
            <h2>
              Exercises score
            </h2>
            <p>
              The score of this exercise (taking into consideration the weigth of each question) is {{ percent|stringformat:".2f" }} {% trans "percent correct" %}
            </p>
          </div>
        {% endif %}
      
        
          {% if questions %}
          <h2>
            Answers
          </h2>
          <p>{% trans "Review the questions below and try the exam again in the future"%}.</p>

          <table class="ui celled table">
            <thead>
              <tr>
                <th>Question</th>
                <th>Answer</th>
                <th>Evaluated</th>
                <th>weight</th>
                <th>Correct</th>
                <th>Explanation</th>
              </tr>
          </thead>
          <tbody>
            {% for question in details %}
            <tr>
              <td>
                {{ question.content }}
              </td>
              <td>
                {% autoescape off %}{{ question.ans }}{% endautoescape %}
              </td>
              <td>
                {{ question.evaluated }}
              </td>
              <td>
                {{ question.evaluationWeight }}
              </td>
              <td>
                {% if question.correct %}
                <div class="well " style="background-color: #99edc3;">
              {% else %}
              <div class="well " style="background-color: #bc544b;">
                {% endif %}

                {{ question.correct }}
                </div>
              </td>
              <td>
                {% autoescape off %} {{ question.expl }}{% endautoescape %}
              </td>
        
              <hr>
            </tr>

          {% endfor %}
        </tbody>
        </table>
        {% endif %}
        
        </div>
			</div>
		</div>  
	</div>
</div>


{% endblock %}

{% block script %}
<script type='text/javascript'>
  document.addEventListener("DOMContentLoaded", () => {
    $('.tabular.menu .item').tab();                  
  });
</script>

{% endblock%}
